# Multi-Remote Upload Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER INTERFACE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FolderScreen    â”‚  â”‚ RemoteManagement â”‚  â”‚ AddEditRemote    â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚    Screen        â”‚  â”‚    Screen        â”‚  â”‚
â”‚  â”‚ - File grid      â”‚  â”‚ - List remotes   â”‚  â”‚ - Name field     â”‚  â”‚
â”‚  â”‚ - Upload button  â”‚  â”‚ - Toggle active  â”‚  â”‚ - Color picker   â”‚  â”‚
â”‚  â”‚ - Progress sheet â”‚  â”‚ - Add/Edit/Del   â”‚  â”‚ - S3/Drive form  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                       â”‚                      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚                      â”‚
          â–¼                       â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          VIEW MODELS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FolderViewModel  â”‚  â”‚ RemoteMgmtVM     â”‚  â”‚ AddEditRemoteVM  â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚
â”‚  â”‚ - uploadStates   â”‚  â”‚ - remotes Flow   â”‚  â”‚ - form fields    â”‚  â”‚
â”‚  â”‚ - uploadFiles()  â”‚  â”‚ - toggle()       â”‚  â”‚ - saveRemote()   â”‚  â”‚
â”‚  â”‚ - retryUpload()  â”‚  â”‚ - deleteRemote() â”‚  â”‚ - validation     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                       â”‚                      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚                      â”‚
          â–¼                       â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         COORDINATOR             â”‚                      â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚                      â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚            â”‚
â”‚  â”‚  MultiRemoteUploadCoordinator                  â”‚   â”‚            â”‚
â”‚  â”‚                                                 â”‚   â”‚            â”‚
â”‚  â”‚  - uploadStates: StateFlow<Map<FileUpload>>    â”‚   â”‚            â”‚
â”‚  â”‚  - uploadSemaphore: Semaphore(5)               â”‚   â”‚            â”‚
â”‚  â”‚  - stateMutex: Mutex                           â”‚   â”‚            â”‚
â”‚  â”‚                                                 â”‚   â”‚            â”‚
â”‚  â”‚  + uploadFiles(files, scope)                   â”‚   â”‚            â”‚
â”‚  â”‚  + retryUpload(fileId, remoteId)               â”‚   â”‚            â”‚
â”‚  â”‚  + clearCompleted()                            â”‚   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚
â”‚         â”‚                       â”‚                      â”‚            â”‚
â”‚         â”‚                       â–¼                      â–¼            â”‚
â”‚         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚         â”‚              â”‚ RemoteConfigRepository            â”‚       â”‚
â”‚         â”‚              â”‚                                   â”‚       â”‚
â”‚         â”‚              â”‚ - DataStore persistence           â”‚       â”‚
â”‚         â”‚              â”‚ - CRUD operations                 â”‚       â”‚
â”‚         â”‚              â”‚ + getAllRemotes()                 â”‚       â”‚
â”‚         â”‚              â”‚ + getActiveRemotes()              â”‚       â”‚
â”‚         â”‚              â”‚ + addRemote()                     â”‚       â”‚
â”‚         â”‚              â”‚ + updateRemote()                  â”‚       â”‚
â”‚         â”‚              â”‚ + deleteRemote()                  â”‚       â”‚
â”‚         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                                                           â”‚
â”‚         â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ RemoteRepositoryFactory    â”‚                                    â”‚
â”‚  â”‚                            â”‚                                    â”‚
â”‚  â”‚ - repositoryCache: Map     â”‚                                    â”‚
â”‚  â”‚                            â”‚                                    â”‚
â”‚  â”‚ + getRepository(config)    â”‚                                    â”‚
â”‚  â”‚ + clearCache()             â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚         â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚  Creates instances based on RemoteConfig type
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     REPOSITORY INSTANCES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ S3RepositoryInst   â”‚              â”‚ GoogleDriveRepoInst    â”‚    â”‚
â”‚  â”‚                    â”‚              â”‚                        â”‚    â”‚
â”‚  â”‚ - config: S3Config â”‚              â”‚ - accountEmail: String â”‚    â”‚
â”‚  â”‚ - minioClient      â”‚              â”‚ - driveService         â”‚    â”‚
â”‚  â”‚                    â”‚              â”‚ - folderCache          â”‚    â”‚
â”‚  â”‚ uploadFile() â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”       â”‚                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚       â”‚ uploadFile() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”  â”‚
â”‚         â”‚                    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜
          â”‚                    â”‚                                  â”‚
          â–¼                    â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLOUD SERVICES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   S3 Bucket 1  â”‚   â”‚   S3 Bucket 2  â”‚   â”‚  Google Drive  â”‚     â”‚
â”‚  â”‚   ğŸŸ¦ Blue      â”‚   â”‚   ğŸŸ§ Orange    â”‚   â”‚   ğŸŸ© Green     â”‚     â”‚
â”‚  â”‚                â”‚   â”‚                â”‚   â”‚                â”‚     â”‚
â”‚  â”‚ endpoint1.com  â”‚   â”‚ endpoint2.com  â”‚   â”‚ user@gmail.com â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Upload Flow Sequence

```
User clicks "Upload" on 5 files
         â”‚
         â–¼
FolderViewModel.uploadFiles([file1, file2, file3, file4, file5])
         â”‚
         â–¼
MultiRemoteUploadCoordinator.uploadFiles()
         â”‚
         â”œâ”€ Check active remotes: [S3-Blue, S3-Orange, Drive-Green]
         â”‚
         â”œâ”€ Initialize state for each file:
         â”‚   â”œâ”€ file1: {S3-Blue: QUEUED, S3-Orange: QUEUED, Drive-Green: QUEUED}
         â”‚   â”œâ”€ file2: {S3-Blue: QUEUED, S3-Orange: QUEUED, Drive-Green: QUEUED}
         â”‚   â”œâ”€ file3: {S3-Blue: QUEUED, S3-Orange: QUEUED, Drive-Green: QUEUED}
         â”‚   â”œâ”€ file4: {S3-Blue: QUEUED, S3-Orange: QUEUED, Drive-Green: QUEUED}
         â”‚   â””â”€ file5: {S3-Blue: QUEUED, S3-Orange: QUEUED, Drive-Green: QUEUED}
         â”‚
         â””â”€ Launch parallel uploads (5 files Ã— 3 remotes = 15 operations)
             â”‚
             â”œâ”€ Semaphore controls max 5 concurrent
             â”‚
             â”œâ”€ [SLOT 1] file1 â†’ S3-Blue      [IN_PROGRESS]
             â”œâ”€ [SLOT 2] file1 â†’ S3-Orange    [IN_PROGRESS]
             â”œâ”€ [SLOT 3] file1 â†’ Drive-Green  [IN_PROGRESS]
             â”œâ”€ [SLOT 4] file2 â†’ S3-Blue      [IN_PROGRESS]
             â”œâ”€ [SLOT 5] file2 â†’ S3-Orange    [IN_PROGRESS]
             â”‚
             â”œâ”€ [QUEUED] file2 â†’ Drive-Green  [QUEUED] â† Waiting
             â”œâ”€ [QUEUED] file3 â†’ S3-Blue      [QUEUED]
             â”œâ”€ [QUEUED] file3 â†’ S3-Orange    [QUEUED]
             â”‚   ...and so on
             â”‚
             â””â”€ As slots free up, queued operations start

Progress:
    file1: [âœ“ Blue] [â³ Orange 47%] [â³ Green 12%]
    file2: [â³ Blue 89%] [âœ“ Orange] [ğŸ“‹ Queued]
    file3: [ğŸ“‹ Queued] [ğŸ“‹ Queued] [ğŸ“‹ Queued]
```

## State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Upload State Transition Diagram                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚   QUEUED    â”‚                      â”‚
â”‚                    â”‚  ğŸ“‹ Waiting  â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                           â”‚                             â”‚
â”‚                Semaphore.acquire()                      â”‚
â”‚                           â”‚                             â”‚
â”‚                           â–¼                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚ IN_PROGRESS â”‚                      â”‚
â”‚                    â”‚ â³ Uploading â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                           â”‚                             â”‚
â”‚                  Upload completes                       â”‚
â”‚                           â”‚                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚              â”‚                         â”‚                â”‚
â”‚              â–¼                         â–¼                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚       â”‚  SUCCESS   â”‚           â”‚   FAILED   â”‚           â”‚
â”‚       â”‚ âœ“ Complete â”‚           â”‚ âŒ Error   â”‚           â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                       â”‚                 â”‚
â”‚                                  User clicks             â”‚
â”‚                                    "Retry"               â”‚
â”‚                                       â”‚                 â”‚
â”‚                                       â–¼                 â”‚
â”‚                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                                 â”‚   QUEUED    â”‚         â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Models

```
RemoteConfig (sealed class)
â”œâ”€â”€ S3Remote
â”‚   â”œâ”€â”€ id: String
â”‚   â”œâ”€â”€ name: String
â”‚   â”œâ”€â”€ color: Color
â”‚   â”œâ”€â”€ isActive: Boolean
â”‚   â”œâ”€â”€ endpoint: String
â”‚   â”œâ”€â”€ accessKey: String
â”‚   â”œâ”€â”€ secretKey: String
â”‚   â”œâ”€â”€ bucketName: String
â”‚   â””â”€â”€ region: String
â”‚
â””â”€â”€ GoogleDriveRemote
    â”œâ”€â”€ id: String
    â”œâ”€â”€ name: String
    â”œâ”€â”€ color: Color
    â”œâ”€â”€ isActive: Boolean
    â”œâ”€â”€ accountEmail: String
    â””â”€â”€ refreshToken: String?

FileUploadState
â”œâ”€â”€ fileId: String
â”œâ”€â”€ fileName: String
â”œâ”€â”€ fileSize: Long
â””â”€â”€ remoteResults: Map<String, RemoteUploadResult>
    â”‚
    â””â”€â”€ RemoteUploadResult
        â”œâ”€â”€ remoteId: String
        â”œâ”€â”€ remoteName: String
        â”œâ”€â”€ remoteColor: Color
        â”œâ”€â”€ status: UploadStatus
        â”œâ”€â”€ progress: Float
        â”œâ”€â”€ errorMessage: String?
        â”œâ”€â”€ uploadedUrl: String?
        â”œâ”€â”€ startedAt: Long?
        â””â”€â”€ completedAt: Long?
```

## Threading Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Coroutine & Thread Architecture                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Main Thread (UI)                                        â”‚
â”‚  â”œâ”€ Compose UI renders                                  â”‚
â”‚  â”œâ”€ StateFlow collectors                                â”‚
â”‚  â””â”€ User interactions                                   â”‚
â”‚                                                          â”‚
â”‚  ViewModelScope (Main + IO)                             â”‚
â”‚  â”œâ”€ FolderViewModel                                     â”‚
â”‚  â”‚   â””â”€ uploadFiles() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚                                â”‚                     â”‚
â”‚  â””â”€ MultiRemoteUploadCoordinator  â”‚                     â”‚
â”‚      â”œâ”€ Semaphore(5) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚      â”‚   Controls max concurrency                       â”‚
â”‚      â”‚                                                   â”‚
â”‚      â”œâ”€ Mutex (state protection)                        â”‚
â”‚      â”‚   Prevents race conditions                       â”‚
â”‚      â”‚                                                   â”‚
â”‚      â””â”€ Upload Coroutines (Dispatchers.IO)              â”‚
â”‚          â”‚                                               â”‚
â”‚          â”œâ”€ [Thread 1] file1 â†’ remote1                  â”‚
â”‚          â”œâ”€ [Thread 2] file1 â†’ remote2                  â”‚
â”‚          â”œâ”€ [Thread 3] file2 â†’ remote1                  â”‚
â”‚          â”œâ”€ [Thread 4] file2 â†’ remote2                  â”‚
â”‚          â”œâ”€ [Thread 5] file3 â†’ remote1                  â”‚
â”‚          â””â”€ [Waiting]  file3 â†’ remote2 â† Semaphore      â”‚
â”‚                                                          â”‚
â”‚  State Updates (thread-safe)                            â”‚
â”‚  â””â”€ stateMutex.withLock {                               â”‚
â”‚      _uploadStates.update { ... }                       â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI Components Hierarchy

```
FolderScreen
â”œâ”€â”€ Scaffold
â”‚   â”œâ”€â”€ TopBar
â”‚   â”œâ”€â”€ FloatingActionButton (Upload)
â”‚   â””â”€â”€ Content
â”‚       â”œâ”€â”€ FileGrid
â”‚       â”‚   â””â”€â”€ FileCards
â”‚       â”‚       â””â”€â”€ onClick â†’ uploadFiles()
â”‚       â”‚
â”‚       â””â”€â”€ if (uploadStates.isNotEmpty())
â”‚           â”‚
â”‚           â””â”€â”€ MultiRemoteUploadSheet (ModalBottomSheet)
â”‚               â”œâ”€â”€ Header
â”‚               â”‚   â”œâ”€â”€ Title: "Uploading Files"
â”‚               â”‚   â”œâ”€â”€ Progress: "3 of 5 completed"
â”‚               â”‚   â””â”€â”€ Actions: [Clear Completed] [Close]
â”‚               â”‚
â”‚               â””â”€â”€ LazyColumn
â”‚                   â””â”€â”€ FileUploadCard (for each file)
â”‚                       â”œâ”€â”€ File Header
â”‚                       â”‚   â”œâ”€â”€ Filename
â”‚                       â”‚   â”œâ”€â”€ File size
â”‚                       â”‚   â””â”€â”€ Status badge
â”‚                       â”‚
â”‚                       â”œâ”€â”€ Status summary
â”‚                       â”‚   â””â”€â”€ "Uploaded to 2/3 remotes"
â”‚                       â”‚
â”‚                       â””â”€â”€ Remote Status List
â”‚                           â””â”€â”€ RemoteUploadRow (for each remote)
â”‚                               â”œâ”€â”€ Color circle ğŸŸ¦
â”‚                               â”œâ”€â”€ Remote name
â”‚                               â””â”€â”€ Status icon
â”‚                                   â”œâ”€â”€ âœ“ Success
â”‚                                   â”œâ”€â”€ â³ In Progress (with %)
â”‚                                   â”œâ”€â”€ ğŸ“‹ Queued
â”‚                                   â””â”€â”€ âŒ Failed [Retry]
```

## Dependency Injection (Hilt)

```
@Singleton Components:
â”œâ”€â”€ RemoteConfigRepository
â”œâ”€â”€ RemoteRepositoryFactory
â”œâ”€â”€ MultiRemoteUploadCoordinator
â”œâ”€â”€ RemoteConfigMigration
â””â”€â”€ S3SessionManager

@HiltViewModel:
â”œâ”€â”€ FolderViewModel
â”œâ”€â”€ RemoteManagementViewModel
â””â”€â”€ AddEditRemoteViewModel

Injection Graph:
FolderViewModel
â”œâ”€ @Inject MultiRemoteUploadCoordinator
â”‚   â”œâ”€ @Inject RemoteConfigRepository
â”‚   â””â”€ @Inject RemoteRepositoryFactory
â”‚       â”œâ”€ @Inject SecureFileManager
â”‚       â”œâ”€ @Inject FolderRepository
â”‚       â””â”€ @Inject S3SessionManager
â””â”€ @Inject RemoteConfigRepository
```

This architecture ensures:
- âœ… Clean separation of concerns
- âœ… Thread-safe concurrent operations
- âœ… Scalable to any number of remotes
- âœ… Easy to test each component independently
- âœ… Reactive UI updates via StateFlow
- âœ… Proper resource management with coroutine scopes
